"use strict";function leadingZero(e){return e.toString().length<2&&(e="0"+e),e}function monthFromDate(e){return 0==e?"Jan":1==e?"Feb":2==e?"Mar":3==e?"Apr":4==e?"May":5==e?"Jun":6==e?"Jul":7==e?"Aug":8==e?"Sep":9==e?"Oct":10==e?"Nov":11==e?"Dec":void 0}Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this.getTime()-e.getTime())/864e5+e.getDay()+1)/7)},Date.prototype.getMonthFormatted=function(){var e=this.getMonth()+1;return 10>e?"0"+e:e},Date.prototype.getDateFormatted=function(){var e=this.getDate();return 10>e?"0"+e:e},String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,a){return"undefined"!=typeof e[a]?e[a]:t})}),String.prototype.formatNum||(String.prototype.formatNum=function(e){for(var t=""+this;t.length<e;)t="0"+t;return t}),function(e){function t(e,t){var a,n,s;s=e,a=e.indexOf("?")<0?"?":"&";for(n in t)s+=a+n+"="+encodeURIComponent(t[n]),a="&";return s}function a(t,a){var n=null!=t.options[a]?t.options[a]:null,s=null!=t.locale[a]?t.locale[a]:null;if("holidays"==a&&t.options.merge_holidays){var i={};return e.extend(!0,i,s?s:d.holidays),n&&e.extend(!0,i,n),i}return null!=n?n:null!=s?s:d[a]}function n(t,i){var r=[],l=a(t,"holidays");for(var d in l)r.push(d+":"+l[d]);if(r.push(i),r=r.join("|"),r in n.cache)return n.cache[r];var h=[];return e.each(l,function(t,a){var n=null,r=null,l=!1;if(e.each(t.split(">"),function(e,a){var d,h=null;if(d=/^(\d\d)-(\d\d)$/.exec(a))h=new Date(i,parseInt(d[2],10)-1,parseInt(d[1],10));else if(d=/^(\d\d)-(\d\d)-(\d\d\d\d)$/.exec(a))parseInt(d[3],10)==i&&(h=new Date(i,parseInt(d[2],10)-1,parseInt(d[1],10)));else if(d=/^easter(([+\-])(\d+))?$/.exec(a))h=o(i,d[1]?parseInt(d[1],10):0);else if(d=/^(\d\d)([+\-])([1-5])\*([0-6])$/.exec(a)){var c=parseInt(d[1],10)-1,u=d[2],p=parseInt(d[3]),v=parseInt(d[4]);switch(u){case"+":for(var m=new Date(i,c,-6);m.getDay()!=v;)m=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1);h=new Date(m.getFullYear(),m.getMonth(),m.getDate()+7*p);break;case"-":for(var m=new Date(i,c+1,7);m.getDay()!=v;)m=new Date(m.getFullYear(),m.getMonth(),m.getDate()-1);h=new Date(m.getFullYear(),m.getMonth(),m.getDate()-7*p)}}if(!h)return s("Unknown holiday: "+t),l=!0,!1;switch(e){case 0:n=h;break;case 1:if(h.getTime()<=n.getTime())return s("Unknown holiday: "+t),l=!0,!1;r=h;break;default:return s("Unknown holiday: "+t),l=!0,!1}}),!l){var d=[];if(r)for(var c=new Date(n.getTime());c.getTime()<=r.getTime();c.setDate(c.getDate()+1))d.push(new Date(c.getTime()));else d.push(n);h.push({name:a,days:d})}}),n.cache[r]=h,n.cache[r]}function s(t){"object"==e.type(window.console)&&"function"==e.type(window.console.warn)&&window.console.warn("[Bootstrap-Calendar] "+t)}function i(t,a){return this.options=e.extend(!0,{position:{start:new Date,end:new Date}},l,t),this.setLanguage(this.options.language),this.context=a,a.css("width",this.options.width).addClass("cal-context"),this.view(),this}function r(t,a,n,s){t.stopPropagation();var a=e(a),i=a.closest(".cal-cell"),r=i.closest(".cal-before-eventlist"),o=i.data("cal-row");a.fadeOut("fast"),n.slideUp("fast",function(){var t=e(".events-list",i);n.html(s.options.templates["events-list"]({cal:s,events:s.getEventsBetween(parseInt(t.data("cal-start")),parseInt(t.data("cal-end")))})),r.after(n),s.activecell=e("[data-cal-date]",i).text(),e("#cal-slide-tick").addClass("tick"+o).show(),n.slideDown("fast",function(){e("body").one("click",function(){n.slideUp("fast"),s.activecell=0})})}),setTimeout(function(){e("a.event-item").mouseenter(function(){e('a[data-event-id="'+e(this).data("event-id")+'"]').closest(".cal-cell1").addClass("day-highlight dh-"+e(this).data("event-class"))}),e("a.event-item").mouseleave(function(){e("div.cal-cell1").removeClass("day-highlight dh-"+e(this).data("event-class"))}),s._update_modal()},400)}function o(e,t){var a=e%19,n=Math.floor(e/100),s=e%100,i=Math.floor(n/4),r=n%4,o=Math.floor((n+8)/25),l=Math.floor((n-o+1)/3),d=(19*a+n-i-l+15)%30,h=Math.floor(s/4),c=s%4,u=(32+2*r+2*h-d-c)%7,p=Math.floor((a+11*d+22*u)/451),v=d+u+7*p+114,m=Math.floor(v/31)-1,g=v%31+1;return new Date(e,m,g+(t?t:0),0,0,0)}var l={width:"100%",view:"month",day:"now",time_start:"06:00",time_end:"22:00",time_split:"30",events_source:"",format12:!1,am_suffix:"AM",pm_suffix:"PM",tmpl_path:"tmpls/",tmpl_cache:!0,classes:{months:{inmonth:"cal-day-inmonth",outmonth:"cal-day-outmonth",saturday:"cal-day-weekend",sunday:"cal-day-weekend",holidays:"cal-day-holiday",today:"cal-day-today"},week:{workday:"cal-day-workday",saturday:"cal-day-weekend",sunday:"cal-day-weekend",holidays:"cal-day-holiday",today:"cal-day-today"}},modal:null,modal_type:"iframe",modal_title:null,views:{year:{slide_events:1,enable:1},month:{slide_events:1,enable:1},week:{enable:1},day:{enable:1}},merge_holidays:!1,display_week_numbers:!0,weekbox:!0,onAfterEventsLoad:function(e){},onBeforeEventsLoad:function(e){e()},onAfterViewLoad:function(e){},onAfterModalShown:function(e){},onAfterModalHidden:function(e){},events:[],templates:{year:"",month:"",week:"",day:""},stop_cycling:!1},d={first_day:2,holidays:{"01-01":"New Year's Day","01+3*1":"Birthday of Dr. Martin Luther King, Jr.","02+3*1":"Washington's Birthday","05-1*1":"Memorial Day","04-07":"Independence Day","09+1*1":"Labor Day","10+2*1":"Columbus Day","11-11":"Veterans Day","11+4*4":"Thanksgiving Day","25-12":"Christmas"}},h={error_noview:"Calendar: View {0} not found",error_dateformat:'Calendar: Wrong date format {0}. Should be either "now" or "yyyy-mm-dd"',error_loadurl:"Calendar: Event URL is not set",error_where:'Calendar: Wrong navigation direction {0}. Can be only "next" or "prev" or "today"',error_timedevide:"Calendar: Time split parameter should divide 60 without decimals. Something like 10, 15, 30",no_events_in_day:"No events in this day.",title_year:"{0}",title_month:"{0} {1}",title_week:"week {0} of {1}",title_day:"{0} {1} {2}, {3}",week:"Week {0}",all_day:"All day",time:"Time",events:"Events",before_time:"Ends before timeline",after_time:"Starts after timeline",m0:"January",m1:"February",m2:"March",m3:"April",m4:"May",m5:"June",m6:"July",m7:"August",m8:"September",m9:"October",m10:"November",m11:"December",ms0:"Jan",ms1:"Feb",ms2:"Mar",ms3:"Apr",ms4:"May",ms5:"Jun",ms6:"Jul",ms7:"Aug",ms8:"Sep",ms9:"Oct",ms10:"Nov",ms11:"Dec",d0:"Sunday",d1:"Monday",d2:"Tuesday",d3:"Wednesday",d4:"Thursday",d5:"Friday",d6:"Saturday"},c="";try{"object"==e.type(window.jstz)&&"function"==e.type(jstz.determine)&&(c=jstz.determine().name(),"string"!==e.type(c)&&(c=""))}catch(u){}n.cache={},i.prototype.setOptions=function(t){e.extend(this.options,t),"language"in t&&this.setLanguage(t.language),"modal"in t&&this._update_modal()},i.prototype.setLanguage=function(t){window.calendar_languages&&t in window.calendar_languages?(this.locale=e.extend(!0,{},h,calendar_languages[t]),this.options.language=t):(this.locale=h,delete this.options.language)},i.prototype._render=function(){this.context.html(""),this._loadTemplate(this.options.view),this.stop_cycling=!1;var e={};e.cal=this,e.day=1,1==a(this,"first_day")?e.days_name=[this.locale.d1,this.locale.d2,this.locale.d3,this.locale.d4,this.locale.d5,this.locale.d6,this.locale.d0]:e.days_name=[this.locale.d0,this.locale.d1,this.locale.d2,this.locale.d3,this.locale.d4,this.locale.d5,this.locale.d6];var t=parseInt(this.options.position.start.getTime()),n=parseInt(this.options.position.end.getTime());switch(e.events=this.getEventsBetween(t,n),this.options.view){case"month":break;case"week":this._calculate_hour_minutes(e);break;case"day":this._calculate_hour_minutes(e)}e.start=new Date(this.options.position.start.getTime()),e.lang=this.locale,this.context.append(this.options.templates[this.options.view](e)),this._update()},i.prototype._format_hour=function(e){var t=e.split(":"),a=parseInt(t[0]),n=parseInt(t[1]),s="";return this.options.format12&&(s=12>a?this.options.am_suffix:this.options.pm_suffix,a%=12,0==a&&(a=12)),a.toString().formatNum(2)+":"+n.toString().formatNum(2)+s},i.prototype._format_time=function(e){return this._format_hour(e.getHours()+":"+e.getMinutes())},i.prototype._calculate_hour_minutes=function(t){var a=this,n=parseInt(this.options.time_split),i=60/n,r=Math.min(i,1);(i>=1&&i%1!=0||1>i&&1440/n%1!=0)&&e.error(this.locale.error_timedevide);var o=this.options.time_start.split(":"),l=this.options.time_end.split(":");t.hours=(parseInt(l[0])-parseInt(o[0]))*r;var d=t.hours*i-parseInt(o[1])/n,h=6e4*n,c=new Date(this.options.position.start.getTime());c.setHours(o[0]),c.setMinutes(o[1]);var u=new Date(this.options.position.end.getTime());u.setHours(l[0]),u.setMinutes(l[1]),t.all_day=[],t.by_hour=[],t.after_time=[],t.before_time=[],e.each(t.events,function(e,n){var i=new Date(parseInt(n.start)),r=new Date(parseInt(n.end));if(n.start_hour=a._format_time(i),n.end_hour=a._format_time(r),n.start<c.getTime()&&(s(1),n.start_hour=i.getDate()+" "+a.locale["ms"+i.getMonth()]+" "+n.start_hour),n.end>u.getTime()&&(s(1),n.end_hour=r.getDate()+" "+a.locale["ms"+r.getMonth()]+" "+n.end_hour),n.start<c.getTime()&&n.end>u.getTime())return void t.all_day.push(n);if(n.end<c.getTime())return void t.before_time.push(n);if(n.start>u.getTime())return void t.after_time.push(n);var o=c.getTime()-n.start;o>=0?n.top=0:n.top=Math.abs(o)/h;var l=Math.abs(d-n.top),p=(n.end-n.start)/h;o>=0&&(p=(n.end-c.getTime())/h),n.lines=p,p>l&&(n.lines=l),t.by_hour.push(n)})},i.prototype._hour_min=function(e){var t=this.options.time_start.split(":"),a=parseInt(this.options.time_split),n=60/a;return 0==e?n-parseInt(t[1])/a:n},i.prototype._hour=function(e,t){var a=this.options.time_start.split(":"),n=parseInt(this.options.time_split),s=""+(parseInt(a[0])+e*Math.max(n/60,1)),i=""+n*t;return this._format_hour(s.formatNum(2)+":"+i.formatNum(2))},i.prototype._week=function(t){this._loadTemplate("week-days");var n={},s=parseInt(this.options.position.start.getTime()),i=parseInt(this.options.position.end.getTime()),r=[],o=this,l=a(this,"first_day");return e.each(this.getEventsBetween(s,i),function(e,t){t.start_day=new Date(parseInt(t.start)).getDay(),1==l&&(t.start_day=(t.start_day+6)%7),t.end-t.start<=864e5?t.days=1:t.days=(t.end-t.start)/864e5,t.start<s&&(t.days=t.days-(s-t.start)/864e5,t.start_day=0),t.days=Math.ceil(t.days),t.start_day+t.days>7&&(t.days=7-t.start_day),r.push(t)}),n.events=r,n.cal=this,o.options.templates["week-days"](n)},i.prototype._month=function(e){this._loadTemplate("year-month");var t={cal:this},a=e+1;t.data_day=this.options.position.start.getFullYear()+"-"+(10>a?"0"+a:a)+"-01",t.month_name=this.locale["m"+e];var n=new Date(this.options.position.start.getFullYear(),e,1,0,0,0);return t.start=parseInt(n.getTime()),t.end=parseInt(new Date(this.options.position.start.getFullYear(),e+1,1,0,0,0).getTime()),t.events=this.getEventsBetween(t.start,t.end),this.options.templates["year-month"](t)},i.prototype._day=function(t,n){this._loadTemplate("month-day");var s={tooltip:"",cal:this},i=this.options.classes.months.outmonth,r=this.options.position.start.getDay();2==a(this,"first_day")?r++:r=0==r?7:r,n=n-r+1;var o=new Date(this.options.position.start.getFullYear(),this.options.position.start.getMonth(),n,0,0,0);n>0&&(i=this.options.classes.months.inmonth);var l=new Date(this.options.position.end.getTime()-1).getDate();if(n+1>l&&(this.stop_cycling=!0),n>l&&(n-=l,i=this.options.classes.months.outmonth),i=e.trim(i+" "+this._getDayClass("months",o)),0>=n){var d=new Date(this.options.position.start.getFullYear(),this.options.position.start.getMonth(),0).getDate();n=d-Math.abs(n),i+=" cal-month-first-row"}var h=this._getHoliday(o);return h!==!1&&(s.tooltip=h),s.data_day=o.getFullYear()+"-"+o.getMonthFormatted()+"-"+(10>n?"0"+n:n),s.cls=i,s.day=n,s.start=parseInt(o.getTime()),s.end=parseInt(s.start+864e5),s.events=this.getEventsBetween(s.start,s.end),this.options.templates["month-day"](s)},i.prototype._getHoliday=function(t){var a=!1;return e.each(n(this,t.getFullYear()),function(){var n=!1;return e.each(this.days,function(){return this.toDateString()==t.toDateString()?(n=!0,!1):void 0}),n?(a=this.name,!1):void 0}),a},i.prototype._getHolidayName=function(e){var t=this._getHoliday(e);return t===!1?"":t},i.prototype._getDayClass=function(e,t){var a=this,n=function(t,n){var s;s=a.options.classes&&e in a.options.classes&&t in a.options.classes[e]?a.options.classes[e][t]:"","string"==typeof s&&s.length&&n.push(s)},s=[];t.toDateString()==(new Date).toDateString()&&n("today",s);var i=this._getHoliday(t);switch(i!==!1&&n("holidays",s),t.getDay()){case 0:n("sunday",s);break;case 6:n("saturday",s)}return n(t.toDateString(),s),s.join(" ")},i.prototype.view=function(e){if(e){if(!this.options.views[e].enable)return;this.options.view=e}this._init_position(),this._loadEvents(),this._render(),this.options.onAfterViewLoad.call(this,this.options.view)},i.prototype.navigate=function(t,a){var n=e.extend({},this.options.position);if("next"==t)switch(this.options.view){case"year":n.start.setFullYear(this.options.position.start.getFullYear()+1);break;case"month":n.start.setMonth(this.options.position.start.getMonth()+1);break;case"week":n.start.setDate(this.options.position.start.getDate()+7);break;case"day":n.start.setDate(this.options.position.start.getDate()+1)}else if("prev"==t)switch(this.options.view){case"year":n.start.setFullYear(this.options.position.start.getFullYear()-1);break;case"month":n.start.setMonth(this.options.position.start.getMonth()-1);break;case"week":n.start.setDate(this.options.position.start.getDate()-7);break;case"day":n.start.setDate(this.options.position.start.getDate()-1)}else"today"==t?n.start.setTime((new Date).getTime()):e.error(this.locale.error_where.format(t));this.options.day=n.start.getFullYear()+"-"+n.start.getMonthFormatted()+"-"+n.start.getDateFormatted(),this.view(),_.isFunction(a)&&a()},i.prototype._init_position=function(){var t,n,s;if("now"==this.options.day){var i=new Date;t=i.getFullYear(),n=i.getMonth(),s=i.getDate()}else if(this.options.day.match(/^\d{4}-\d{2}-\d{2}$/g)){var r=this.options.day.split("-");t=parseInt(r[0],10),n=parseInt(r[1],10)-1,s=parseInt(r[2],10)}else e.error(this.locale.error_dateformat.format(this.options.day));switch(this.options.view){case"year":this.options.position.start.setTime(new Date(t,0,1).getTime()),this.options.position.end.setTime(new Date(t+1,0,1).getTime());break;case"month":this.options.position.start.setTime(new Date(t,n,1).getTime()),this.options.position.end.setTime(new Date(t,n+1,1).getTime());break;case"day":this.options.position.start.setTime(new Date(t,n,s).getTime()),this.options.position.end.setTime(new Date(t,n,s+1).getTime());break;case"week":var o,l=new Date(t,n,s);o=1==a(this,"first_day")?l.getDate()-(l.getDay()+6)%7:l.getDate()-l.getDay(),this.options.position.start.setTime(new Date(t,n,o).getTime()),this.options.position.end.setTime(new Date(t,n,o+7).getTime());break;default:e.error(this.locale.error_noview.format(this.options.view))}return this},i.prototype.getTitle=function(){var e=this.options.position.start;switch(this.options.view){case"year":return this.locale.title_year.format(e.getFullYear());case"month":return this.locale.title_month.format(this.locale["m"+e.getMonth()],e.getFullYear());case"week":return this.locale.title_week.format(e.getWeek(),e.getFullYear());case"day":return this.locale.title_day.format(this.locale["d"+e.getDay()],e.getDate(),this.locale["m"+e.getMonth()],e.getFullYear())}},i.prototype.isToday=function(){var e=(new Date).getTime();return e>this.options.position.start&&e<this.options.position.end},i.prototype.getStartDate=function(){return this.options.position.start},i.prototype.getEndDate=function(){return this.options.position.end},i.prototype._loadEvents=function(){var a=this,n=null;"events_source"in this.options&&""!==this.options.events_source?n=this.options.events_source:"events_url"in this.options&&(n=this.options.events_url,s("The events_url option is DEPRECATED and it will be REMOVED in near future. Please use events_source instead."));var i;switch(e.type(n)){case"function":i=function(){return n(a.options.position.start,a.options.position.end,c)};break;case"array":i=function(){return[].concat(n)};break;case"string":n.length&&(i=function(){var s=[],i=new Date,r=i.getTimezoneOffset(),o={from:a.options.position.start.getTime(),to:a.options.position.end.getTime(),utc_offset:r};return c.length&&(o.browser_timezone=c),e.ajax({url:t(n,o),dataType:"json",type:"GET",async:!1}).done(function(t){t.success||e.error(t.error),t.result&&(s=t.result)}),s})}i||e.error(this.locale.error_loadurl),this.options.onBeforeEventsLoad.call(this,function(){a.options.events=i(),a.options.events.sort(function(e,t){var a;return a=e.start-t.start,0==a&&(a=e.end-t.end),a}),a.options.onAfterEventsLoad.call(a,a.options.events)})},i.prototype._templatePath=function(e){return"function"==typeof this.options.tmpl_path?this.options.tmpl_path(e):this.options.tmpl_path+e+".html"},i.prototype._loadTemplate=function(t){if(!this.options.templates[t]){var a=this;e.ajax({url:a._templatePath(t),dataType:"html",type:"GET",async:!1,cache:this.options.tmpl_cache}).done(function(e){a.options.templates[t]=_.template(e)})}},i.prototype._update=function(){var t=this;e('*[data-toggle="tooltip"]').tooltip({container:"body"}),e("*[data-cal-date]").click(function(){var a=e(this).data("cal-view");t.options.day=e(this).data("cal-date"),t.view(a)}),e(".cal-cell").dblclick(function(){var a=e("[data-cal-date]",this).data("cal-view");t.options.day=e("[data-cal-date]",this).data("cal-date"),t.view(a)}),this["_update_"+this.options.view](),this._update_modal()},i.prototype._update_modal=function(){var t=this;if(e("a[data-event-id]",this.context).unbind("click"),t.options.modal){var a=e(t.options.modal);if(a.length){var n=null;"iframe"==t.options.modal_type&&(n=e(document.createElement("iframe")).attr({width:"100%",frameborder:"0"})),e("a[data-event-id]",this.context).on("click",function(s){s.preventDefault(),s.stopPropagation();var i=e(this).attr("href"),r=e(this).data("event-id"),s=_.find(t.options.events,function(e){return e.id==r});"iframe"==t.options.modal_type&&(n.attr("src",i),e(".modal-body",a).html(n)),(!a.data("handled.bootstrap-calendar")||a.data("handled.bootstrap-calendar")&&a.data("handled.event-id")!=s.id)&&a.off("show.bs.modal").off("shown.bs.modal").off("hidden.bs.modal").on("show.bs.modal",function(){var n=e(this).find(".modal-body");switch(t.options.modal_type){case"iframe":var r=n.height()-parseInt(n.css("padding-top"),10)-parseInt(n.css("padding-bottom"),10);e(this).find("iframe").height(Math.max(r,50));break;case"ajax":e.ajax({url:i,dataType:"html",async:!1,success:function(e){n.html(e)}});break;case"template":t._loadTemplate("modal"),n.html(t.options.templates.modal({event:s,calendar:t}))}_.isFunction(t.options.modal_title)&&a.find(".modal-title").html(t.options.modal_title(s))}).on("shown.bs.modal",function(){t.options.onAfterModalShown.call(t,t.options.events)}).on("hidden.bs.modal",function(){t.options.onAfterModalHidden.call(t,t.options.events)}).data("handled.bootstrap-calendar",!0).data("handled.event-id",s.id),a.modal("show")})}}},i.prototype._update_day=function(){e("#cal-day-panel").height(e("#cal-day-panel-hour").height())},i.prototype._update_week=function(){},i.prototype._update_year=function(){this._update_month_year()},i.prototype._update_month=function(){this._update_month_year();var t=this;if(1==this.options.weekbox){var a=e(document.createElement("div")).attr("id","cal-week-box"),n=this.options.position.start.getFullYear()+"-"+this.options.position.start.getMonthFormatted()+"-";t.context.find(".cal-month-box .cal-row-fluid").on("mouseenter",function(){var s=new Date(t.options.position.start),i=e(".cal-cell1:first-child .cal-month-day",this),r=i.hasClass("cal-month-first-row")?1:e("[data-cal-date]",i).text();s.setDate(parseInt(r)),r=10>r?"0"+r:r,a.html(t.locale.week.format(1==t.options.display_week_numbers?s.getWeek():"")),a.attr("data-cal-week",n+r).show().appendTo(i)}).on("mouseleave",function(){a.hide()}),a.click(function(){t.options.day=e(this).data("cal-week"),t.view("week")})}t.context.find("a.event").mouseenter(function(){e('a[data-event-id="'+e(this).data("event-id")+'"]').closest(".cal-cell1").addClass("day-highlight dh-"+e(this).data("event-class"))}),t.context.find("a.event").mouseleave(function(){e("div.cal-cell1").removeClass("day-highlight dh-"+e(this).data("event-class"))})},i.prototype._update_month_year=function(){if(this.options.views[this.options.view].slide_events){var t=this;t.context.find(".cal-month-day, .cal-year-box .span3").on("mouseenter",function(){0!=e(".events-list",this).length&&e(this).children("[data-cal-date]").text()==t.activecell}).on("mouseleave",function(){}).on("click",function(n){0!=e(".events-list",this).length&&e(this).children("[data-cal-date]").text()!=t.activecell&&r(n,e(null),a,t)});var a=e(document.createElement("div")).attr("id","cal-slide-box");a.hide().click(function(e){e.stopPropagation()}),this._loadTemplate("events-list")}},i.prototype.getEventsBetween=function(t,a){var n=[];return e.each(this.options.events,function(){if(null==this.start)return!0;var e=this.end||this.start;parseInt(this.start)<a&&parseInt(e)>=t&&n.push(this)}),n},e.fn.calendar=function(e){return new i(e,this)}}(jQuery),function(e){function t(){if(e("#calendar").parent().outerWidth()<=a)return e("#calendar").addClass("hidden"),e("#eventlist").removeClass("hidden"),!0;var t=!1;return e("#calendar").hasClass("hidden")&&(t=!0),e("#calendar").removeClass("hidden"),t&&s._render(),e("#eventlist").addClass("hidden"),e(".event-buttons--bottom").removeClass("hidden"),!1}if(e("#calendar").length>0){var a=800;e('[data-toggle="popover"]').popover();var n={events_source:"/ajax-actions?a=events",view:"month",tmpl_path:"/_inc/tmpls/",tmpl_cache:!1,onAfterEventsLoad:function(a){if(a){var n=this.getStartDate().getTime(),s=this.getEndDate().getTime();t();var i=e("#eventlist");i.html("");var r=e.grep(a,function(e){return parseInt(e.start)>=n&&parseInt(e.start)<=s||parseInt(e.end)>=n&&parseInt(e.end)<=s});0==r.length&&e("#calendar").hasClass("hidden")?(e(".event-buttons--bottom").addClass("hidden"),e(document.createElement("div")).addClass("event-container").html("<h4>No events this month</h4>").appendTo(i)):e(".event-buttons--bottom").removeClass("hidden");e.each(r,function(t,a){a.date_start=new Date(parseInt(a.start)),a.date_end=new Date(parseInt(a.end));var n=a.date_start.getDate()+" "+monthFromDate(a.date_start.getMonth())+" "+a.date_start.getFullYear()+" at "+leadingZero(a.date_start.getHours())+":"+leadingZero(a.date_start.getMinutes()),s=a.date_end.getDate()+" "+monthFromDate(a.date_end.getMonth())+" "+a.date_end.getFullYear()+" at "+leadingZero(a.date_end.getHours())+":"+leadingZero(a.date_end.getMinutes());a.date_start.getDate()+"/"+a.date_start.getMonth()+"/"+a.date_start.getFullYear()==a.date_end.getDate()+"/"+a.date_end.getMonth()+"/"+a.date_end.getFullYear()&&(s=leadingZero(a.date_end.getHours())+":"+leadingZero(a.date_end.getMinutes()));var r="";r+='<div class="event-date">'+n+" - "+s+"</div>",r+='<div class="event-type "'+a["class"]+">"+a.type+"</div>",r+="<h3>"+a.title+"</h3>",a.img_url&&(r+='<div class="event-image"><img src="'+a.img_url+'"/></div>'),r+="<p>",a.description&&(r+=a.description),r+="</p>",r+='<div class="event-info-button"><a href="'+a.url+'" class="btn btn-primary"><i class="icon-calendar"></i> More info</a></div>',e(document.createElement("div")).addClass("event-container").html(r).appendTo(i)})}},onAfterViewLoad:function(t){e(".calendar-title").text(this.getTitle()),e(".btn-group button").removeClass("active"),e('button[data-calendar-view="'+t+'"]').addClass("active");var a=e(".cal-row-fluid");e.each(a,function(t,a){var n=e(this),s=n.find(".events-list");if(s.length>0){var i=n.children(".cal-cell"),r=n.outerHeight(!0);e.each(i,function(t,a){var n=e(this).children().first();n.outerHeight(r)})}})},classes:{months:{general:"label"}},modal:"#events-modal",modal_type:"template",weekbox:!1},s=e("#calendar").calendar(n);e(".btn-group button[data-calendar-nav]").each(function(){var t=e(this);t.click(function(){s.navigate(t.data("calendar-nav"))})}),e("#first_day").change(function(){var t=e(this).val();t=t.length?parseInt(t):null,s.setOptions({first_day:t}),s.view()}),e("#events-modal .modal-header, #events-modal .modal-footer").click(function(e){}),e(window).resize(function(){if(!t()){var a=e(".cal-row-fluid");e.each(a,function(t,a){var n=e(this),s=n.find(".events-list");if(s.length>0){var i=n.children(".cal-cell"),r=n.outerHeight(!0);e.each(i,function(t,a){var n=e(this);n.outerHeight(r)})}})}})}e("#PublishEvent").length>0&&e("#PublishEvent").on("click",function(t){e("#event-publish-modal").modal("show"),t.preventDefault(),t.stopPropagation();var a=e(this),n=a.data("id"),s={a:"pubevt",id:n};e.ajax({dataType:"json",url:"/ajax-actions",data:s}).done(function(t){console.log(t),"valid"==s.response?(document.location=t.data,e("#event-publish-modal").modal("hide")):window.alert("Problem: "+t.data)})})}(jQuery);
